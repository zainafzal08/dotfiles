#!/bin/bash

file_path=`echo $1 | sed 's/\//\-/g'`;
cd ~/repos/qwilr/master/;
git pull;
git fetch;
git worktree add ../$file_path $1;
cd ~/repos/qwilr/$file_path;

cp ~/repos/qwilr-zafzal/.env .;

./install-all.sh;

cd nginx;

rm -f ssl/qwilr.local.crt;
rm -f ssl/qwilr.local.key;
rm -f ssl/rootCA.key;
rm -f ssl/qwilr.local.csr;
rm -f ssl/rootCA.crt;
rm -f ssl/rootCA.srl;
cp ~/repos/qwilr-zafzal/ssl/* ssl/;
mkdir run;
mkdir run/proxy_temp;

cd ../pages;

cp ~/repos/qwilr-zafzal/.dev.vars .;

cd ..;

cursor -r .;

export WORKTREE=$file_path;
cd ~/repos/qwilr/$WORKTREE;
pm2 delete all;
pm2 start ~/repos/qwilr-zafzal/ecosystem.config.js;
